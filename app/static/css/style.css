:root{
  --orange:#ff6600;--orange-h:#ff7a1a;
  --orange-10:rgba(255,102,0,.08);--orange-20:rgba(255,102,0,.15);
  --bg:#000;--s1:#0a0a0a;--s2:#111;--s3:#1a1a1a;
  --b1:#222;--b2:#333;
  --t1:#fff;--t2:#999;--t3:#666;--t4:#444;
  --r:10px;
  --font:-apple-system,BlinkMacSystemFont,'Segoe UI','Inter',Roboto,sans-serif;
  --mono:'SF Mono','Fira Code',Consolas,Monaco,monospace;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{height:100%}
body{
  height:100%;display:flex;flex-direction:column;overflow:hidden;
  font-family:var(--font);background:var(--bg);color:var(--t1);
  -webkit-font-smoothing:antialiased;
}
::selection{background:var(--orange-20)}
::-webkit-scrollbar{width:5px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--b1);border-radius:3px}

/* ---- Dot canvas background ---- */
#bg-canvas{
  position:fixed;top:0;left:0;width:100%;height:100%;
  z-index:0;pointer-events:none;
}

/* ---- Header / Logo ---- */
header{
  flex-shrink:0;text-align:center;padding:28px 24px 0;
  position:relative;z-index:1;
}
.logo{
  font-size:42px;font-weight:700;letter-spacing:-.5px;
  color:var(--t1);line-height:1;
}
.logo span{color:var(--orange)}
.tagline{
  font-size:13px;color:var(--t4);margin-top:8px;letter-spacing:.2px;
}

/* ---- Main chat area ---- */
main{
  flex:1;overflow-y:auto;position:relative;z-index:1;
}
#messages{max-width:640px;margin:0 auto;padding:8px 24px 24px}

/* ---- Empty state ---- */
#empty-state{
  text-align:center;max-width:480px;margin:0 auto;
  padding:48px 24px 0;
  transition:opacity .4s,visibility .4s,max-height .4s;
  overflow:hidden;
}
#empty-state.gone{opacity:0;visibility:hidden;max-height:0;padding:0 24px}
#empty-state p{font-size:15px;line-height:1.7;color:var(--t3)}
#empty-state .hint{
  margin-top:28px;font-size:12px;color:var(--t4);letter-spacing:.3px;
}

/* ---- Messages ---- */
.msg{margin-bottom:14px;animation:msgIn .3s ease}
@keyframes msgIn{from{opacity:0;transform:translateY(6px)}to{opacity:1}}
.msg-user{display:flex;justify-content:flex-end}
.msg-user .bubble{
  background:var(--s3);border-radius:var(--r) var(--r) 4px var(--r);
  padding:10px 16px;max-width:460px;font-size:14px;line-height:1.6;
}
.msg-sys{display:flex;justify-content:flex-start}
.msg-sys .bubble{
  background:var(--s1);border:1px solid var(--b1);
  border-radius:var(--r) var(--r) var(--r) 4px;
  padding:16px 20px;max-width:540px;font-size:14px;line-height:1.6;width:100%;
}

/* Loading dots */
.dots{display:flex;gap:5px;padding:4px 0}
.dots span{
  width:5px;height:5px;border-radius:50%;background:var(--t3);
  animation:dotP 1.4s infinite;
}
.dots span:nth-child(2){animation-delay:.2s}
.dots span:nth-child(3){animation-delay:.4s}
@keyframes dotP{0%,80%,100%{opacity:.25;transform:scale(.85)}40%{opacity:1;transform:scale(1)}}

/* ---- Analysis bubble ---- */
.a-label{
  font-size:10px;font-weight:600;text-transform:uppercase;
  letter-spacing:.6px;color:var(--orange);margin-bottom:16px;
}
.conf-row{display:flex;align-items:baseline;gap:8px;margin-bottom:8px}
.conf-num{font-size:28px;font-weight:700;font-family:var(--mono);color:var(--t1)}
.conf-pct{font-size:13px;color:var(--t3)}
.conf-track{height:3px;background:var(--s3);border-radius:2px;position:relative;margin-bottom:20px}
.conf-fill{height:100%;border-radius:2px;background:var(--orange);transition:width .6s cubic-bezier(.4,0,.2,1)}
.rec-box{
  font-size:12px;line-height:1.6;color:var(--t3);margin-bottom:20px;
  padding:10px 14px;background:var(--orange-10);border-radius:8px;
  border-left:2px solid var(--orange);
}
.options{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px}
.opt{
  border:1px solid var(--b1);border-radius:8px;padding:14px 16px;
  cursor:pointer;transition:all .15s;
}
.opt:hover{border-color:var(--b2)}
.opt.on{border-color:var(--orange);background:var(--orange-10)}
.opt-hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.opt-title{font-size:13px;font-weight:600}
.opt-dot{
  width:14px;height:14px;border-radius:50%;border:2px solid var(--b1);
  transition:all .15s;flex-shrink:0;
}
.opt.on .opt-dot{border-color:var(--orange);background:var(--orange)}
.opt-meta{font-size:11px;color:var(--t3);line-height:1.7}
.opt-tag{
  display:inline-block;font-size:9px;font-weight:600;padding:2px 6px;
  border-radius:4px;margin-top:6px;text-transform:uppercase;letter-spacing:.4px;
}
.tag-priv{background:rgba(16,185,129,.12);color:#34d399}
.tag-api{background:rgba(129,140,248,.12);color:#a5b4fc}
.prov-row{display:flex;gap:4px;margin-top:10px}
.prov-btn{
  padding:3px 8px;font-size:9px;font-weight:600;border-radius:4px;
  border:1px solid var(--b1);background:transparent;color:var(--t4);
  cursor:pointer;transition:all .15s;font-family:var(--font);
}
.prov-btn:hover{border-color:var(--b2)}
.prov-btn.on{border-color:var(--orange);color:var(--orange);background:var(--orange-10)}
.prov-btn:disabled{opacity:.25;cursor:not-allowed}
.exec-btn{
  width:100%;padding:10px;border:none;border-radius:8px;
  background:var(--orange);color:#000;font-size:13px;font-weight:600;
  cursor:pointer;transition:all .15s;font-family:var(--font);
}
.exec-btn:hover{background:var(--orange-h);box-shadow:0 0 24px rgba(255,102,0,.15)}
.exec-btn:disabled{opacity:.35;cursor:not-allowed;box-shadow:none}

/* Locked options after execution */
.options.locked .opt{cursor:default;pointer-events:none;opacity:.55}
.options.locked .opt.on{opacity:.85}
.options.locked .prov-btn{pointer-events:none}

/* ---- Result bubble ---- */
.r-label{
  font-size:10px;font-weight:600;text-transform:uppercase;
  letter-spacing:.6px;color:var(--orange);margin-bottom:12px;
}
.r-meta{display:flex;gap:14px;font-size:11px;color:var(--t3);margin-bottom:14px}
.r-meta .r-src{color:var(--orange);font-weight:600}
.fn-card{
  background:var(--s3);border-radius:8px;padding:12px 14px;
  font-family:var(--mono);font-size:12px;margin-bottom:6px;
}
.fn-name{color:var(--orange);font-weight:600;margin-bottom:4px}
.fn-name.fail{color:#f87171}
.fn-k{color:var(--t3)}.fn-v{color:var(--t1)}
.err-box{
  background:rgba(239,68,68,.08);border:1px solid rgba(239,68,68,.3);
  border-radius:8px;padding:10px 14px;color:#f87171;font-size:12px;margin:8px 0;
}
.no-calls{color:var(--t4);font-size:12px;margin-top:8px}

/* ---- Centered state (no chats) ---- */
body:not(.has-chats){justify-content:center}
body:not(.has-chats) header{position:absolute;top:0;left:0;right:0}
body:not(.has-chats) main{flex:none;overflow:visible}
body:not(.has-chats) footer{border-top:none;background:transparent}
body:not(.has-chats) #empty-state{padding-top:0;padding-bottom:16px}

/* ---- Input footer ---- */
footer{
  flex-shrink:0;border-top:1px solid var(--b1);
  padding:14px 24px 20px;background:var(--bg);
  position:relative;z-index:1;
  transition:border-color .3s,background .3s;
  will-change:transform;
}
.input-wrap{max-width:640px;margin:0 auto;display:flex;gap:8px;align-items:flex-end}
#input{
  flex:1;resize:none;border:1px solid var(--b1);border-radius:var(--r);
  background:var(--s1);color:var(--t1);font-size:14px;padding:10px 14px;
  font-family:var(--font);line-height:1.5;max-height:120px;transition:border-color .15s;
}
#input:focus{outline:none;border-color:var(--orange)}
#input::placeholder{color:var(--t4)}
#send-btn{
  width:40px;height:40px;border-radius:var(--r);border:none;
  background:var(--orange);color:#000;cursor:pointer;
  display:flex;align-items:center;justify-content:center;flex-shrink:0;
  transition:all .15s;
}
#send-btn:hover{background:var(--orange-h);box-shadow:0 0 20px rgba(255,102,0,.18)}
#send-btn:disabled{opacity:.25;cursor:not-allowed;box-shadow:none}
#send-btn svg{width:16px;height:16px}

@media(max-width:640px){
  .logo{font-size:30px}
  .options{grid-template-columns:1fr}
  #empty-state p{font-size:14px}
}
